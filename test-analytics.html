<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç –¢–µ—Å—Ç Telegram Analytics</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
            max-width: 800px;
            margin: 0 auto;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button { 
            padding: 12px 24px; 
            margin: 10px; 
            background: #0088ff; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #0066cc; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .success { color: #4CAF50; font-weight: bold; }
        .error { color: #f44336; font-weight: bold; }
        .info { color: #2196F3; }
        .warning { color: #FF9800; font-weight: bold; }
        .result { 
            margin: 15px 0; 
            padding: 15px; 
            background: #f0f8ff; 
            border-radius: 5px; 
            border-left: 4px solid #2196F3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        .status.warning { background: #fff3cd; color: #856404; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #e9ecef;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram Analytics SDK</h1>
        <p>–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤ –≤–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.</p>
        
        <div id="initStatus" class="status info">
            üìä –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º SDK...
        </div>
    </div>

    <div class="card">
        <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π</h2>
        <button onclick="testBasicEvent()" id="testBtn1">üì§ –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è</button>
        <button onclick="testCustomEvent()" id="testBtn2">üéØ –¢–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ–±—ã—Ç–∏—è</button>
        <button onclick="testDirectAPI()" id="testBtn3">üîß –¢–µ—Å—Ç –ø—Ä—è–º–æ–≥–æ API</button>
        <button onclick="checkNetworkRequests()" id="checkBtn">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Network –∑–∞–ø—Ä–æ—Å—ã</button>
    </div>

    <div class="card">
        <h2>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
        <div id="results">
            <p class="info">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...</p>
        </div>
    </div>

    <div class="card">
        <h2>üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div id="techInfo">
            <p>üì± User Agent: <span id="userAgent"></span></p>
            <p>üåê URL: <span id="currentUrl"></span></p>
            <p>‚è∞ –í—Ä–µ–º—è: <span id="timestamp"></span></p>
            <p>üìû Telegram WebApp: <span id="telegramStatus"></span></p>
        </div>
    </div>

    <script>
        const API_TOKEN = 'eyJhcHBfbmFtZSI6ImlzcGVlY2hfaGVscGVyIiwiYXBwX3VybCI6Imh0dHBzOi8vdC5tZS9pU3BlZWNoSGVscGVyX2JvdCIsImFwcF9kb21haW4iOiJodHRwczovL2ktc3BlZWNoLWhlbHBlci11Y2U0LnZlcmNlbC5hcHAifQ==!xnr1GO/F3uekQi8c2s7KcdMvjEP35yprm/UWP9Z7q4A=';
        const APP_NAME = 'ispeech_helper';
        
        let analyticsInitialized = false;
        let networkRequests = [];
        let isInTelegram = false;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω—ã –ª–∏ –º—ã –≤ Telegram
        function checkTelegramEnvironment() {
            isInTelegram = !!(window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initData);
            document.getElementById('telegramStatus').textContent = isInTelegram ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç (–æ–±—ã—á–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä)';
            return isInTelegram;
        }

        // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –¥–ª—è Telegram WebApp –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        function setupTelegramMock() {
            if (!window.Telegram) {
                window.Telegram = {
                    WebApp: {
                        initData: 'mock_init_data',
                        initDataUnsafe: {
                            user: { id: 12345, username: 'test_user' },
                            start_param: 'test'
                        },
                        colorScheme: 'light',
                        themeParams: {},
                        version: '6.0',
                        platform: 'web',
                        ready: function() {},
                        close: function() {},
                        expand: function() {}
                    }
                };
                addResult('üîß –°–æ–∑–¥–∞–Ω–∞ –∑–∞–≥–ª—É—à–∫–∞ Telegram WebApp –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'warning');
            }
        }

        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ fetch –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const url = args[0];
            const options = args[1] || {};
            
            if (typeof url === 'string' && url.includes('tganalytics.xyz')) {
                networkRequests.push({
                    url: url,
                    method: options.method || 'GET',
                    timestamp: new Date().toLocaleTimeString(),
                    body: options.body
                });
            }
            
            return originalFetch.apply(this, args);
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            updateTechInfo();
            checkTelegramEnvironment();
            
            if (!isInTelegram) {
                setupTelegramMock();
                addResult('‚ö†Ô∏è –ó–∞–ø—É—â–µ–Ω–æ –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å.', 'warning');
                addResult('üí° –î–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram Mini App', 'info');
            }
        });

        function updateTechInfo() {
            document.getElementById('userAgent').textContent = navigator.userAgent.substring(0, 100) + '...';
            document.getElementById('currentUrl').textContent = window.location.href;
            document.getElementById('timestamp').textContent = new Date().toLocaleString('ru-RU');
        }

        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        function handleSDKLoadError() {
            const initStatus = document.getElementById('initStatus');
            initStatus.className = 'status error';
            initStatus.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ SDK —Å tganalytics.xyz';
            addResult('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å SDK. –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ç—å—é –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–æ–º.', 'error');
        }

        function initAnalytics() {
            const initStatus = document.getElementById('initStatus');
            
            try {
                if (typeof window.telegramAnalytics !== 'undefined') {
                    // –ü—ã—Ç–∞–µ–º—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å SDK
                    try {
                        window.telegramAnalytics.init({
                            token: API_TOKEN,
                            appName: APP_NAME,
                        });
                        
                        analyticsInitialized = true;
                        initStatus.className = 'status success';
                        initStatus.innerHTML = '‚úÖ Telegram Analytics SDK —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!';
                        addResult('‚úÖ SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å —Ç–æ–∫–µ–Ω–æ–º –∏ app_name', 'success');
                        
                        // –í—ã–≤–æ–¥–∏–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã SDK
                        addResult(`üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã SDK: ${Object.keys(window.telegramAnalytics).join(', ')}`, 'info');
                        
                    } catch (initError) {
                        // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
                        initStatus.className = 'status warning';
                        initStatus.innerHTML = '‚ö†Ô∏è SDK –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ –Ω–µ –º–æ–∂–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤–Ω–µ Telegram';
                        addResult(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–æ–∂–∏–¥–∞–µ–º–æ –≤–Ω–µ Telegram): ${initError.message}`, 'warning');
                        
                        // –í—Å–µ —Ä–∞–≤–Ω–æ —Å—á–∏—Ç–∞–µ–º —á—Ç–æ SDK –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø—Ä—è–º–æ–≥–æ API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                        analyticsInitialized = false; // –û—Ç–∫–ª—é—á–∞–µ–º –º–µ—Ç–æ–¥—ã SDK
                        
                        // –í—ã–≤–æ–¥–∏–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã SDK –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                        if (window.telegramAnalytics) {
                            addResult(`üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã SDK: ${Object.keys(window.telegramAnalytics).join(', ')}`, 'info');
                        }
                    }
                    
                    // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    window.testAnalytics = testBasicEvent;
                    window.checkAnalytics = checkNetworkRequests;
                    
                    addResult('üîß –§—É–Ω–∫—Ü–∏–∏ testAnalytics() –∏ checkAnalytics() –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª–∏', 'info');
                } else {
                    throw new Error('telegramAnalytics –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ window –æ–±—ä–µ–∫—Ç–µ');
                }
            } catch (error) {
                initStatus.className = 'status error';
                initStatus.innerHTML = `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ SDK: ${error.message}`;
                addResult(`‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ SDK: ${error.message}`, 'error');
            }
        }

        function testBasicEvent() {
            addResult('üîÑ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –±–∞–∑–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ SDK...', 'info');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã API
                if (window.telegramAnalytics && typeof window.telegramAnalytics.track === 'function') {
                    window.telegramAnalytics.track('custom-event', {
                        custom_data: {
                            test_type: 'basic_event',
                            timestamp: Date.now(),
                            source: 'test_file'
                        }
                    });
                    addResult('‚úÖ –ë–∞–∑–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ .track()!', 'success');
                    
                } else if (window.telegramAnalytics && typeof window.telegramAnalytics.sendEvent === 'function') {
                    window.telegramAnalytics.sendEvent('custom-event', {
                        custom_data: {
                            test_type: 'basic_event',
                            timestamp: Date.now(),
                            source: 'test_file'
                        }
                    });
                    addResult('‚úÖ –ë–∞–∑–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ .sendEvent()!', 'success');
                    
                } else if (window.telegramAnalytics && typeof window.telegramAnalytics.pushEvent === 'function') {
                    window.telegramAnalytics.pushEvent({
                        event_type: 'custom-event',
                        custom_data: {
                            test_type: 'basic_event',
                            timestamp: Date.now(),
                            source: 'test_file'
                        }
                    });
                    addResult('‚úÖ –ë–∞–∑–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ .pushEvent()!', 'success');
                    
                } else {
                    addResult('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –ø–æ–¥—Ö–æ–¥—è—â–∏–π –º–µ—Ç–æ–¥ SDK. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä—è–º–æ–π API —Ç–µ—Å—Ç.', 'error');
                    if (window.telegramAnalytics) {
                        addResult(`üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã: ${Object.keys(window.telegramAnalytics).join(', ')}`, 'info');
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
                setTimeout(() => {
                    addResult(`üìä –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API: ${networkRequests.length}`, 'info');
                }, 1000);
                
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–∞–∑–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è: ${error.message}`, 'error');
            }
        }

        function testCustomEvent() {
            addResult('üîÑ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ...', 'info');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã API
                if (window.telegramAnalytics && typeof window.telegramAnalytics.track === 'function') {
                    window.telegramAnalytics.track('user-interaction', {
                        custom_data: {
                            action: 'button_click',
                            element: 'test_custom_event_btn',
                            timestamp: Date.now(),
                            session_id: generateSessionId(),
                            browser: getBrowserName(),
                            screen_resolution: `${screen.width}x${screen.height}`
                        }
                    });
                    addResult('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ .track()!', 'success');
                    
                } else if (window.telegramAnalytics && typeof window.telegramAnalytics.sendEvent === 'function') {
                    window.telegramAnalytics.sendEvent('user-interaction', {
                        custom_data: {
                            action: 'button_click',
                            element: 'test_custom_event_btn',
                            timestamp: Date.now(),
                            session_id: generateSessionId(),
                            browser: getBrowserName(),
                            screen_resolution: `${screen.width}x${screen.height}`
                        }
                    });
                    addResult('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ .sendEvent()!', 'success');
                    
                } else {
                    addResult('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –ø–æ–¥—Ö–æ–¥—è—â–∏–π –º–µ—Ç–æ–¥ SDK. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä—è–º–æ–π API —Ç–µ—Å—Ç.', 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ–±—ã—Ç–∏—è: ${error.message}`, 'error');
            }
        }

        async function testDirectAPI() {
            addResult('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä—è–º–æ–π API –≤—ã–∑–æ–≤...', 'info');
            
            try {
                const eventData = {
                    event_type: 'custom-event',
                    app_name: APP_NAME,
                    timestamp: Date.now(),
                    custom_data: {
                        test_type: 'direct_api_test',
                        source: 'browser_test',
                        browser: getBrowserName(),
                        screen_resolution: `${screen.width}x${screen.height}`,
                        user_agent: navigator.userAgent.substring(0, 100)
                    }
                };

                addResult(`üìã –û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ: <pre>${JSON.stringify(eventData, null, 2)}</pre>`, 'info');

                // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
                const headers = {
                    'Content-Type': 'application/json',
                    'TGA-Auth-Token': API_TOKEN,
                    'Authorization': `Bearer ${API_TOKEN}`,
                    'X-Requested-With': 'XMLHttpRequest',
                    'Accept': 'application/json',
                };

                // –î–ª—è –æ–±—Ö–æ–¥–∞ CORS - —Å–∏–º—É–ª–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞
                if (window.location.hostname === 'localhost') {
                    headers['Origin'] = 'https://i-speech-helper-uce4.vercel.app';
                    headers['Referer'] = 'https://i-speech-helper-uce4.vercel.app/';
                }

                addResult(`üì° –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏: <pre>${JSON.stringify(headers, null, 2)}</pre>`, 'info');

                const response = await fetch('https://tganalytics.xyz/events', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(eventData),
                    mode: 'cors'
                });

                addResult(`üì° –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`, 
                          response.ok ? 'success' : 'error');

                const responseText = await response.text();
                
                if (response.ok) {
                    addResult(`‚úÖ –ü—Ä—è–º–æ–π API —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω! –û—Ç–≤–µ—Ç: ${responseText}`, 'success');
                } else {
                    addResult(`‚ùå –û—à–∏–±–∫–∞ API: ${responseText}`, 'error');
                    
                    // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –¥–æ–º–µ–Ω–∞ - –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É
                    if (responseText.includes('domain') || responseText.includes('Domain')) {
                        addResult(`üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: http://localhost:3000`, 'warning');
                        addResult(`üí° –ò–ª–∏ –≤ Telegram Mini App: https://i-speech-helper-uce4.vercel.app`, 'info');
                    }
                }

            } catch (error) {
                addResult(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä—è–º–æ–≥–æ API –≤—ã–∑–æ–≤–∞: ${error.message}`, 'error');
            }
        }

        function checkNetworkRequests() {
            addResult('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω—ã–µ Network –∑–∞–ø—Ä–æ—Å—ã...', 'info');
            
            if (networkRequests.length === 0) {
                addResult('‚ÑπÔ∏è –ü–æ–∫–∞ –Ω–µ –±—ã–ª–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ tganalytics.xyz', 'info');
                addResult('üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ —Å–Ω–∞—á–∞–ª–∞', 'info');
            } else {
                addResult(`üìä –ù–∞–π–¥–µ–Ω–æ –∑–∞–ø—Ä–æ—Å–æ–≤: ${networkRequests.length}`, 'success');
                
                networkRequests.forEach((req, index) => {
                    const details = `
                        <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <strong>–ó–∞–ø—Ä–æ—Å ${index + 1}:</strong><br>
                            üîó URL: ${req.url}<br>
                            üì§ –ú–µ—Ç–æ–¥: ${req.method}<br>
                            ‚è∞ –í—Ä–µ–º—è: ${req.timestamp}<br>
                            ${req.body ? `üìã –î–∞–Ω–Ω—ã–µ: <pre>${req.body}</pre>` : ''}
                        </div>
                    `;
                    addResult(details, 'info');
                });
            }

            // –¢–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ DevTools
            addResult(`
                <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px;">
                    <strong>üîß –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ DevTools:</strong><br>
                    1. –ù–∞–∂–º–∏—Ç–µ F12<br>
                    2. –í–∫–ª–∞–¥–∫–∞ Network<br>
                    3. –§–∏–ª—å—Ç—Ä: tganalytics<br>
                    4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–±—ã—Ç–∏–µ<br>
                    5. –°–º–æ—Ç—Ä–∏—Ç–µ POST –∑–∞–ø—Ä–æ—Å—ã
                </div>
            `, 'info');
        }

        function generateSessionId() {
            return 'session_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }

        function getBrowserName() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome')) return 'Chrome';
            if (ua.includes('Firefox')) return 'Firefox';
            if (ua.includes('Safari')) return 'Safari';
            if (ua.includes('Edge')) return 'Edge';
            return 'Unknown';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        setInterval(function() {
            document.getElementById('timestamp').textContent = new Date().toLocaleString('ru-RU');
        }, 1000);

        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å SDK –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            addResult('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º SDK –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
            const script = document.createElement('script');
            script.src = 'https://tganalytics.xyz/index.js';
            script.onload = initAnalytics;
            script.onerror = handleSDKLoadError;
            document.head.appendChild(script);
        });
    </script>
</body>
</html> 