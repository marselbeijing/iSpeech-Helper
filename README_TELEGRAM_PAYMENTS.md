# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ Telegram Stars

## üöÄ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ (–¥–ª—è –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏)
–ï—Å–ª–∏ `showInvoice` –¥–æ—Å—Ç—É–ø–µ–Ω –≤ Telegram WebApp - –ø–ª–∞—Ç–µ–∂ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞–ø—Ä—è–º—É—é –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

### 2. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ (–¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π)
–ï—Å–ª–∏ `showInvoice` –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–Ω–≤–æ–π—Å —á–µ—Ä–µ–∑ API –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º.

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
cd server
npm install
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ .env
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `server/.env`:
```env
MONGODB_URI=mongodb://localhost:27017/ispeech-helper
TELEGRAM_BOT_TOKEN=7743960366:AAEwZM2KhTJYiQpnSuyZVr9dEkM7WGacMi0
WEBAPP_URL=https://i-speech-helper-uce4.vercel.app/
PORT=5000
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
cd server
npm start
```

## ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞

### 1. –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
- `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `/paysupport` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –ø–ª–∞—Ç–µ–∂–µ–π

### 2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- `pre_checkout_query` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π
- `successful_payment` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## üí∞ –õ–æ–≥–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

### –ö–æ–≥–¥–∞ showInvoice –¥–æ—Å—Ç—É–ø–µ–Ω:
1. –°–æ–∑–¥–∞–µ—Ç—Å—è –∏–Ω–≤–æ–π—Å –ª–æ–∫–∞–ª—å–Ω–æ
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `webApp.showInvoice()`
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –Ω–∞–ø—Ä—è–º—É—é

### –ö–æ–≥–¥–∞ showInvoice –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
1. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ `/api/create-invoice`
2. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω–≤–æ–π—Å–∞ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –≤ —á–∞—Ç
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –≤ —á–∞—Ç–µ —Å –±–æ—Ç–æ–º
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ webhook

## üîß API Endpoints

### POST /api/create-invoice
–°–æ–∑–¥–∞–µ—Ç –∏–Ω–≤–æ–π—Å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```json
{
  "userId": "123456789",
  "planType": "MONTHLY",
  "userInfo": {
    "firstName": "–ò–º—è",
    "lastName": "–§–∞–º–∏–ª–∏—è", 
    "username": "username"
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "invoiceId": "invoice_id",
  "message": "–ò–Ω–≤–æ–π—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º"
}
```

## üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏
3. –ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω `showInvoice` - –æ–ø–ª–∞—á–∏–≤–∞–π—Ç–µ –Ω–∞–ø—Ä—è–º—É—é
4. –ï—Å–ª–∏ –Ω–µ—Ç - –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º

### –í –±—Ä–∞—É–∑–µ—Ä–Ω–æ–π –≤–µ—Ä—Å–∏–∏:
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏
2. –ü–æ–ª—É—á–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º –¥–ª—è –æ–ø–ª–∞—Ç—ã

## üõ† –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ "r[a(...)] is not a function"
‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** - —É–±—Ä–∞–Ω—ã –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Ç–æ–¥—ã `openInvoice` –∏ `sendData`

### showInvoice –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
‚úÖ **–†–µ—à–µ–Ω–æ** - –¥–æ–±–∞–≤–ª–µ–Ω –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ API

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_BOT_TOKEN` –≤ .env
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check
```
GET /health
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ –±–æ—Ç–∞:
```json
{
  "status": "OK",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "botStatus": "connected"
}
```

## üéØ –ü–ª–∞–Ω—ã –ø–æ–¥–ø–∏—Å–æ–∫

- **–ú–µ—Å—è—á–Ω–∞—è**: 300 –∑–≤–µ–∑–¥ (30 –¥–Ω–µ–π)
- **–ö–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è**: 720 –∑–≤–µ–∑–¥ (90 –¥–Ω–µ–π, —Å–∫–∏–¥–∫–∞ 20%)
- **–ì–æ–¥–æ–≤–∞—è**: 2160 –∑–≤–µ–∑–¥ (365 –¥–Ω–µ–π, —Å–∫–∏–¥–∫–∞ 40%)

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü—Ä–æ–≤–µ—Ä–∫–∞ payload –≤ pre_checkout_query
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å—É–º–º—ã
- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∏–Ω–≤–æ–π—Å–∞: 24 —á–∞—Å–∞
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ payload –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ 